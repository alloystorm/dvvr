## 透明素材

透明素材の問題には2つの主要な側面があります：

* 素材が透明か不透明かを判断すること。
* 透明素材のレンダリング順序。

### 透明/不透明素材の判定

XPSモデルデータには、素材のプロパティが含まれており、このプロパティを使用して透明モードを使用するかどうかを判断することができます。したがって、XPSモデルでは通常、誤判定のケースはありません。

一方、PMXモデルではこのようなデータが提供されないため、現在は主に2つの方法を使用しています：
* テクスチャのプロパティに基づいて素材が透明かどうかを推測します。テクスチャにアルファチャンネルが含まれている場合、素材は透明と判断されます。ただし、透明ではなく滑らかな値としてアルファチャンネルを使用する素材など、例外もあります。
* 名前を通じて推測します。たとえば、名前に「shadow」や「hair」といった単語が含まれている場合、透明と判断されます。

したがって、PMXモデルでは一定割合の誤判定のケースが発生する可能性があります。

### 透明素材のレンダリング順序

ほとんどのXPSモデルにはレンダリング順序のデータが含まれているため、通常は大きな問題はありません。

一部のPMXモデルの素材には適切なレンダリング順序がないため、レイヤーを重ねると奇妙な画面が表示されることがあります。

### 透明深度プリパス（HD）

デフォルトでは、HDおよびRTバージョンでは透明深度プリパスモードがオンになります。このモードでは、すべての透明素材が深度プリパスパスを経て、zバッファを使用して素材のレイヤリング関係を決定し、最上位の透明素材が正しくレンダリングされるようにします。このアプローチはレイヤリングの問題を解決できますが、欠点として、下にあるすべての素材が破棄されることです。モデルが複数のレイヤーを同時に表示する必要がある場合や、髪と透明な衣服、またはキャラクターが他の透明なオブジェクトによって遮られている場合など、問題が発生する可能性があります。このモードはシステム設定でオフにすることができます。

バージョン1.4.3以降では、各個別の素材に対して独立した微調整の深度プリパス設定が可能です：

* 透明プリパススイッチ：各素材は独自に深度プリパスを使用するかどうかを制御できます。
* 透明プリパス閾値：深度プリパスを使用する場合、このパラメータを使用して深度プリパス領域を制御できます。値が大きいほど、深度プリパスの範囲が狭くなります。デフォルト設定は0.8です。

### 透明素材の設定

個々の素材オプションでは、素材の透明モードを変更することができます。自動、透明強制、または不透明強制に設定することができます。

髪のオプションでは、すべての髪素材の透明モードを変更することができます。

グローバルな素材設定では、いくつかの異なるオプションから透明度の並べ替え順序を選択することができます。