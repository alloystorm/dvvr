---
layout: single
title: AI驱动的语音聊天
toc: true
sidebar:
  nav: "docs-zh"
---

## AI驱动的语音聊天

### 主要特点
* 选择使用 OpenAI、本地或远程文本生成 WebUI 作为 AI 服务
* 内置 TTS 引擎将 AI 生成的消息转换为语音
* 内置唇同步，自动为角色的脸部做动画，使他们说话时显得真实
* 内置语音识别将您的语音转换为文本并发送给 AI
* 包括超过 900 个英文语音供选择，每个角色都可以有自己独特的语音

### 限制
* 语音引擎仅支持 Windows。在其他平台上，您仍然可以使用语音识别进行交谈，但响应将仅为文本。

## AI 服务
有多种作为 AI 服务的选项以赋予您的角色智能。我们将在下面讨论每个选项的利弊。

### OpenAI (ChatGPT)
这是目前最智能的选项。

**优点:**
* 智能
* 快速
* 与其他远程选项相比，成本效益

**缺点:**
* 受到审查

**设置:**
要在 DanceXR 中使用 OpenAI 服务，您需要一个 OpenAI API 密钥。
* 注册并登录您的 OpenAI 账户。
* 点击页面右上角的个人资料图标。
* 选择"查看 API 密钥"以打开 API 页面。
* 点击"创建新的秘密密钥"并在出现时复制该密钥。请记住，密钥**只在此处显示一次**，您以后不能检索完整的密钥，所以不要丢失它。
* 打开 DanceXR 并从聊天菜单中点击配置图标。
* 转到 AI 服务并在 "OpenAI API 密钥"框中粘贴您的密钥。
* 然后在 "AI 服务"下拉列表中选择 "OpenAI (ChatGPT)"，您应该可以使用了。

### OobaBooga 文本生成 WebUI 
此选项允许您在 PC 足够强大时本地运行大型语言模型（LLM）。7b 或 13b 的模型对于聊天应该足够好。

**优点:**
* 隐私，不发送任何内容，一切都在本地发生。
* 您可以使用未经审查的模型进行 NSFW 内容。
* 免费

**缺点:**
* 不如 OpenAI 模型智能
* 需要一些设置
* 如果 VRAM 不足，可能会变得非常慢。尤其是当您同时运行 DanceXR 时，系统可能会将 LLM 推送到虚拟 VRAM，这将破坏其性能。

**设置:** 
* 按照此处的说明下载并安装 https://github.com/oobabooga/text-generation-webui
* 要允许 WebUI 与 DanceXR 一起工作，您需要打开 API。为此，打开 CMD_FLAGS.txt 文件并在其中添加 "--listen --api"，然后重启它。
* 运行后，转到模型选项卡并下载模型（如果您还没有的话）。
* 我们建议使用以下两个模型之一: https://huggingface.co/TheBloke/Luna-AI-Llama2-Uncensored-GPTQ (7b，运行更轻松) https://huggingface.co/TheBloke/Nous-Hermes-Llama2-GPTQ (13b, 更智能)
* 刷新模型列表并加载。
* 在 DanceXR 中，从 AI 服务 -> 选择服务中选择 "Local WebUI"
* 默认 URL (http://127.0.0.1:5000) 应该可以工作，除非您的设置需要不同的端口或 URL。


### 使用 Runpod 等远程服务运行 WebUI
有些服务允许您租用 GPU 并运行 AI 模型。Runpod 就是其中之一。他们为 WebUI 提供了一个模板，比本地设置更容易。

**优点:** 
* 快速且简单
* 自由选择您想要运行的任何模型。即使是在您的本地 GPU 上无法运行的模型。

**缺点:**
* 比 OpenAI 稍微贵一些
* 每次运行时都需要下载模型。但这应该只需要几分钟。

**设置:**
* 从 "Community Cloud" 中选择一个 GPU 并点击 "Deploy"。3080ti 应该足以运行一个 13b 模型。这需要每小时 26 美分。
* 从模板下拉列表中选择 "RunPod TheBloke LLMs"。
* 运行后，点击连接，它会给您提供 WebUI 和 API 的链接，复制 API 的 URL 并在 DanceXR 的 "Remote WebUI URL" 框中粘贴。
* 点击 WebUI 链接，然后转到模型选项卡下载模型。
* 我们建议使用以下两个模型之一: https://huggingface.co/TheBloke/Luna-AI-Llama2-Uncensored-GPTQ (7b，运行更轻松) https://huggingface.co/TheBloke/Nous-Hermes-Llama2-GPTQ (13b, 更智能)
* 刷新模型列表并加载。


## 聊天控制

### 模板
模板驱动 AI 模型为每个角色生成聊天消息。您可能认为这很复杂，但实际上非常简单。您可以打开 chat/templates 文件夹以查看默认模板并了解其工作方式。

基本上，这就像用纯文本告诉某人为您做某事。您可以修改默认模板并另存为不同的名称，以查看它如何影响聊天内容。例如，您可以在其中添加环境描述，为聊天设置场景。

在 DanceXR 中，转到聊天设置 -> 模板，选择您创建的模板。


### 角色
角色是根据演员模型的名称派生的。例如 "Koharu Bouquet Cattleya Hair B Side Ponytail"，"Koharu" 将被解释为角色名称，其余的 "Bouquet Cattleya Hair B Side Ponytail" 将被用作她的服装描述。

如果它们是知名的，语言模型可能对角色有一些了解，所以它有时知道它们是谁以及它们如何表现，特别是当您使用 OpenAI 时。

在角色设置中，您可以为角色输入描述和个性，这将很大程度上影响它们在聊天中的表现。例如，您可以通过仅描述它们为 "服从并渴望取悦" 来改变一个骄傲和傲慢的角色。

"玩家" 在技术上也是一个角色，您可以更改自己的名称、描述和个性，并成为您喜欢的任何人。


### 人物
角色设置还有一个下拉菜单 "Persona"。这允许您使用从 AI 角色扮演程序（如 TavernAI）下载的角色。这些通常以 PNG 格式提供。png 图像的元数据包含角色的描述。

使用此在线角色编辑器将 png 角色转换为 json 格式 https://zoltanai.github.io/character-editor/

然后将 json 放在 "chat/personas" 文件夹中，它们将出现在角色设置中的 "Persona" 下拉菜单中。完成此操作后，角色的描述将覆盖角色描述。


### 聊天历史
每次生成新内容时，聊天历史都会发送给 AI，以保持上下文。如果您想切换到不同的场景或主题，请先清除历史记录，以便 AI 不受先前的聊天上下文的影响。您还可以使用此功能来操纵环境并驱动聊天。例如，如果您在消息中描述了某些事件，AI 将继续在该上下文中进行。

请注意，一旦达到提示限制，最早的消息将被忽略，不包括在上下文中。因此，AI 可能会忘记历史记录中太远的事情。

在聊天界面中，您可以点击聊天消息旁边的图标来操纵聊天历史。选项包括：

* 重新生成：删除以下所有消息并让 AI 重新生成此消息
* 重写：接管消息并自己重写。当您这样做时，您需要保持消息前面的名称和冒号完整，否则系统将不知道此消息来自谁。
* 重播：从此消息重播聊天历史
* 删除条目：删除此消息
* 删除上方：删除此消息上方的所有消息
* 删除下方：删除此消息下方的所有消息

### 温度
此值控制 AI 模型在生成聊天消息时的自由度。就像图像生成一样，对于相同的输入，每次生成可能会略有不同，温度控制它可以变化的程度。

### 存在惩罚和频率惩罚
增加这些值以减少 AI 生成重复内容的机会。

### 最大生成令牌和最大提示长度
LLMs 有令牌限制，超出此限制的内容将无法正确生成。

### 自动生成和为玩家生成
打开 "Auto Generate Next" 允许 AI 在计时器到时时自动生成下一条消息。

打开 "Generate For Player" 允许 AI 为玩家生成消息。

## 文字转语音

### 附加语音
DanceXR 使用一个名为 Piper 的 TTS 引擎。在这里，您可以听取并下载供 DanceXR 使用的其他语音模型。

https://rhasspy.github.io/piper-samples/

下载后，将它们放在 chat\voices\piper 文件夹中。请记住，onnx 和 onnx.json 文件都是必需的。

### 语音管理器
内置的语音模型包含超过 900 种不同的语音。默认情况下，我们只启用其中的前 20 个。因为 900 个对用户来说选择太多了。要启用其他语音，请转到聊天设置中的语音 -> 语音管理器，从列表中选择一个语音，听取并勾选 "Selected"，以允许它被添加到语音列表中。

您可以为系统、玩家和每个角色选择不同的语音。

### 语言匹配 & 备用
AI 模型可以生成不同的语言消息。但是语音模型不能。DanceXR 会尝试确定消息的语言，如果它不匹配所选的语音语言，启用语音设置中的 "Fallback" 将允许它从语音列表中选择与语言匹配的其他语音。

## 语音转文字
内置的 Whisper 模型可以将您的语音转换为文本，然后发送给 AI。有两种模式，手动和自动。

### 手动模式
手动模式意味着您点击麦克风按钮，开始录音，完成后再次点击，音频将被处理，然后结果将被发送给 AI。

### 自动模式
自动模式意味着当聊天空闲时（角色不说话）它会自动开始录音，在飞行中处理音频，然后在您停止说话后发送。但是有时它不是很聪明。

对于低端设备，将音频转换为文本可能需要一些时间。因此，对于 Android、Quest 和 Pico，不建议使用自动模式。

### 键绑定
在输入设置中，您可以为麦克风状态分配一个按钮，这样您可以在不进入 UI 的情况下控制录音。默认情况下，它被分配给右手控制器的菜单按钮。

## 重置配置和角色设置
所有内容都保存在您的内容库的聊天文件夹中。随时删除聊天文件夹以将所有内容重置为默认值。
